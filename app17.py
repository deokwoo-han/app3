import streamlit as st
import google.generativeai as genai
from datetime import date, timedelta
from io import BytesIO
from docx import Document
from docx.enum.text import WD_ALIGN_PARAGRAPH

# -------------------------------------------------------------------------
# [0. ì‹œìŠ¤í…œ ì„¤ì • ë° ì„¸ì…˜ ì´ˆê¸°í™”]
# -------------------------------------------------------------------------
st.set_page_config(page_title="AI ë²•ë¥  ë§ˆìŠ¤í„° (Pro)", page_icon="âš–ï¸", layout="wide")

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if 'rec_court' not in st.session_state: st.session_state['rec_court'] = "ë²•ì› ì§ì ‘ ì„ íƒ"
if 'amt_in' not in st.session_state: st.session_state['amt_in'] = "30000000"
if 'chat_history' not in st.session_state: st.session_state['chat_history'] = []

# -------------------------------------------------------------------------
# [1. ì •ë°€ ë°ì´í„°ë² ì´ìŠ¤: ë²•ì›/ì§€ìì²´/ìœ íŠœë¸Œ/íŠ¹ìˆ˜ê´€í• ]
# -------------------------------------------------------------------------

# ê¸°ë³¸ ë²•ì› ë¦¬ìŠ¤íŠ¸ (ì§€ë°©ë²•ì› ë° ì§€ì›)
COURT_LIST = [
    "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›",
    "ì„œìš¸ê°€ì •ë²•ì›", "ì„œìš¸í–‰ì •ë²•ì›", "ì„œìš¸íšŒìƒë²•ì›",  # íŠ¹ìˆ˜ ë²•ì› ì¶”ê°€
    "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›", "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›",
    "ì¸ì²œì§€ë°©ë²•ì›", "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›", "ì¸ì²œê°€ì •ë²•ì›",
    "ìˆ˜ì›ì§€ë°©ë²•ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "ìˆ˜ì›ê°€ì •ë²•ì›", "ìˆ˜ì›íšŒìƒë²•ì›",
    "ì¶˜ì²œì§€ë°©ë²•ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›",
    "ëŒ€ì „ì§€ë°©ë²•ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›", "ëŒ€ì „ê°€ì •ë²•ì›",
    "ì²­ì£¼ì§€ë°©ë²•ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›",
    "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ê²½ì£¼ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›", "ëŒ€êµ¬ê°€ì •ë²•ì›",
    "ë¶€ì‚°ì§€ë°©ë²•ì›", "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë¶€ì‚°ê°€ì •ë²•ì›", "ë¶€ì‚°íšŒìƒë²•ì›",
    "ìš¸ì‚°ì§€ë°©ë²•ì›", "ìš¸ì‚°ê°€ì •ë²•ì›",
    "ì°½ì›ì§€ë°©ë²•ì›", "ì°½ì›ì§€ë°©ë²•ì› ë§ˆì‚°ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›",
    "ê´‘ì£¼ì§€ë°©ë²•ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›", "ê´‘ì£¼ê°€ì •ë²•ì›",
    "ì „ì£¼ì§€ë°©ë²•ì›", "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›", "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›",
    "ì œì£¼ì§€ë°©ë²•ì›"
]

# ê¸°ì´ˆìì¹˜ë‹¨ì²´ -> ê´€í•  ë²•ì› ë§¤í•‘ (ëˆ„ë½ ë³´ì™„íŒ)
JURISDICTION_MAP = {
    # [ì„œìš¸ - ì‚¬ê±´ ì¢…ë¥˜ì— ë”°ë¼ íŠ¹ìˆ˜ë²•ì›ìœ¼ë¡œ ë¶„ê¸° ì²˜ë¦¬ í•„ìš”]
    "ì¢…ë¡œ": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì¤‘êµ¬": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ê°•ë‚¨": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì„œì´ˆ": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ê´€ì•…": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ë™ì‘": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›",
    "ì„±ë™": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ê´‘ì§„": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ê°•ë™": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ì†¡íŒŒ": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›",
    "ì˜ë“±í¬": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ê°•ì„œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ì–‘ì²œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "êµ¬ë¡œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ê¸ˆì²œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›",
    "ë™ëŒ€ë¬¸": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì¤‘ë‘": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì„±ë¶": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ë„ë´‰": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ê°•ë¶": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ë…¸ì›": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›",
    "ì€í‰": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ì„œëŒ€ë¬¸": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ë§ˆí¬": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ìš©ì‚°": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›",
    # [ê²½ê¸°]
    "ê³ ì–‘": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›", "íŒŒì£¼": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›",
    "ë‚¨ì–‘ì£¼": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›", "êµ¬ë¦¬": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›", "ê°€í‰": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›",
    "ì˜ì •ë¶€": "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ì–‘ì£¼": "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "í¬ì²œ": "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ë™ë‘ì²œ": "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ì—°ì²œ": "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ì² ì›": "ì˜ì •ë¶€ì§€ë°©ë²•ì›",
    "ë¶€ì²œ": "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›", "ê¹€í¬": "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›",
    "ì¸ì²œ": "ì¸ì²œì§€ë°©ë²•ì›", "ê°•í™”": "ì¸ì²œì§€ë°©ë²•ì›",
    "ì„±ë‚¨": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "í•˜ë‚¨": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "ê´‘ì£¼": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›",
    "ì•ˆì‚°": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ê´‘ëª…": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ì‹œí¥": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›",
    "ì•ˆì–‘": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "ê³¼ì²œ": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "ì˜ì™•": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "êµ°í¬": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›",
    "í‰íƒ": "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›", "ì•ˆì„±": "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›",
    "ì—¬ì£¼": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ì´ì²œ": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ì–‘í‰": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›",
    "ìˆ˜ì›": "ìˆ˜ì›ì§€ë°©ë²•ì›", "ìš©ì¸": "ìˆ˜ì›ì§€ë°©ë²•ì›", "í™”ì„±": "ìˆ˜ì›ì§€ë°©ë²•ì›", "ì˜¤ì‚°": "ìˆ˜ì›ì§€ë°©ë²•ì›",
    # [ê°•ì›]
    "ì¶˜ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "í™”ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "ì–‘êµ¬": "ì¶˜ì²œì§€ë°©ë²•ì›", "ì¸ì œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "í™ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›",
    "ì›ì£¼": "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›", "íš¡ì„±": "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›",
    "ê°•ë¦‰": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ë™í•´": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ì‚¼ì²™": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›",
    "ì†ì´ˆ": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ê³ ì„±": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ì–‘ì–‘": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›",
    "ì˜ì›”": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›", "íƒœë°±": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›", "ì •ì„ ": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›", "í‰ì°½": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›",
    # [ì¶©ì²­] - ì„¸ì¢… ì¶”ê°€ë¨
    "ëŒ€ì „": "ëŒ€ì „ì§€ë°©ë²•ì›", "ì„¸ì¢…": "ëŒ€ì „ì§€ë°©ë²•ì›", "ê¸ˆì‚°": "ëŒ€ì „ì§€ë°©ë²•ì›",
    "ì²œì•ˆ": "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›", "ì•„ì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›",
    "ì„œì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "ë‹¹ì§„": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "íƒœì•ˆ": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›",
    "í™ì„±": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ë³´ë ¹": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ì„œì²œ": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ì˜ˆì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›",
    "ê³µì£¼": "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›", "ì²­ì–‘": "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›",
    "ë…¼ì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ê³„ë£¡": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ë¶€ì—¬": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›",
    "ì²­ì£¼": "ì²­ì£¼ì§€ë°©ë²•ì›", "ì§„ì²œ": "ì²­ì£¼ì§€ë°©ë²•ì›", "ë³´ì€": "ì²­ì£¼ì§€ë°©ë²•ì›", "ê´´ì‚°": "ì²­ì£¼ì§€ë°©ë²•ì›", "ì¦í‰": "ì²­ì£¼ì§€ë°©ë²•ì›",
    "ì¶©ì£¼": "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›", "ìŒì„±": "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›",
    "ì œì²œ": "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›", "ë‹¨ì–‘": "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›",
    "ì˜ë™": "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›", "ì˜¥ì²œ": "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›",
    # [ê²½ìƒ]
    "ëŒ€êµ¬": "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ê²½ì‚°": "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ì²­ë„": "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ì¹ ê³¡": "ëŒ€êµ¬ì§€ë°©ë²•ì›",
    "ë‹¬ì„œ": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë‹¬ì„±": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ê³ ë ¹": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ì„±ì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›",
    "í¬í•­": "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›", "ìš¸ë¦‰": "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›",
    "ê²½ì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê²½ì£¼ì§€ì›",
    "ê¹€ì²œ": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›", "êµ¬ë¯¸": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›",
    "ì•ˆë™": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ì˜ì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ë´‰í™”": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›",
    "ìƒì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ë¬¸ê²½": "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ì˜ˆì²œ": "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›",
    "ì˜ì„±": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›", "êµ°ìœ„": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›", "ì²­ì†¡": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›",
    "ì˜ë•": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›", "ì˜ì–‘": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›", "ìš¸ì§„": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›",
    "ë¶€ì‚°": "ë¶€ì‚°ì§€ë°©ë²•ì›",
    "í•´ìš´ëŒ€": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ê¸°ì¥": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›",
    "ê°•ì„œ": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ì‚¬í•˜": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ì‚¬ìƒ": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë¶êµ¬": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›",
    "ìš¸ì‚°": "ìš¸ì‚°ì§€ë°©ë²•ì›", "ì–‘ì‚°": "ìš¸ì‚°ì§€ë°©ë²•ì›",
    "ì°½ì›": "ì°½ì›ì§€ë°©ë²•ì›", "ê¹€í•´": "ì°½ì›ì§€ë°©ë²•ì›", "í•¨ì•ˆ": "ì°½ì›ì§€ë°©ë²•ì›", "ì˜ë ¹": "ì°½ì›ì§€ë°©ë²•ì›",
    "ë§ˆì‚°": "ì°½ì›ì§€ë°©ë²•ì› ë§ˆì‚°ì§€ì›",
    "ì§„ì£¼": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ì‚¬ì²œ": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ë‚¨í•´": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "í•˜ë™": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ì‚°ì²­": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›",
    "í†µì˜": "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›", "ê±°ì œ": "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›", "ê³ ì„±": "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›",
    "ë°€ì–‘": "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›", "ì°½ë…•": "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›",
    "ê±°ì°½": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›", "í•¨ì–‘": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›", "í•©ì²œ": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›",
    # [ì „ë¼/ì œì£¼]
    "ê´‘ì£¼": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ë‚˜ì£¼": "ê´‘ì£¼ì§€ë°©ë²•ì›", "í™”ìˆœ": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ì¥ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ë‹´ì–‘": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ê³¡ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ì˜ê´‘": "ê´‘ì£¼ì§€ë°©ë²•ì›",
    "ìˆœì²œ": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ì—¬ìˆ˜": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê´‘ì–‘": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "êµ¬ë¡€": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ë³´ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê³ í¥": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›",
    "ëª©í¬": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ë¬´ì•ˆ": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ì‹ ì•ˆ": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "í•¨í‰": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ì˜ì•”": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›",
    "ì¥í¥": "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›", "ê°•ì§„": "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›",
    "í•´ë‚¨": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›", "ì™„ë„": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›", "ì§„ë„": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›",
    "ì „ì£¼": "ì „ì£¼ì§€ë°©ë²•ì›", "ì™„ì£¼": "ì „ì£¼ì§€ë°©ë²•ì›", "ê¹€ì œ": "ì „ì£¼ì§€ë°©ë²•ì›", "ë¬´ì£¼": "ì „ì£¼ì§€ë°©ë²•ì›", "ì§„ì•ˆ": "ì „ì£¼ì§€ë°©ë²•ì›", "ì¥ìˆ˜": "ì „ì£¼ì§€ë°©ë²•ì›", "ì„ì‹¤": "ì „ì£¼ì§€ë°©ë²•ì›",
    "êµ°ì‚°": "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›", "ìµì‚°": "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›",
    "ì •ì": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ë¶€ì•ˆ": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ê³ ì°½": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›",
    "ë‚¨ì›": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ìˆœì°½": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›",
    "ì œì£¼": "ì œì£¼ì§€ë°©ë²•ì›", "ì„œê·€í¬": "ì œì£¼ì§€ë°©ë²•ì›"
}

# ë§ˆì¸ë“œ ì¼€ì–´ DB (ìœ íŠœë¸Œ ë¹„ë””ì˜¤ ID í¬í•¨)
MIND_CARE_DB = {
    "start": {
        "advice": "ì‹œì‘ì´ ë°˜ì…ë‹ˆë‹¤. ê¶Œë¦¬ êµ¬ì œì˜ ì²«ê±¸ìŒì„ ì‘ì›í•©ë‹ˆë‹¤.", 
        "video": "https://www.youtube.com/watch?v=pzlw6fUux4o"  # Bach Air on G String
    },
    "wait": {
        "advice": "ë²•ì›ì€ ì¦ê±°ë¡œ ë§í•©ë‹ˆë‹¤. ì°¨ë¶„íˆ ë‹µë³€ì„œë¥¼ ê¸°ë‹¤ë¦¬ë©° ìˆ¨ì„ ê³ ë¥´ì„¸ìš”.", 
        "video": "https://www.youtube.com/watch?v=HuM1k6d7NXI"  # Bill Evans - Peace Piece style
    },
    "fight": {
        "advice": "ê°ì •ì  ëŒ€ì‘ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤. ì›…ì¥í•œ ìŒì•…ê³¼ í•¨ê»˜ ìš©ê¸°ë¥¼ ì–»ìœ¼ì„¸ìš”.", 
        "video": "https://www.youtube.com/watch?v=v2AcV5rV_wA"  # Beethoven Symphony 5 (1st mov)
    },
    "trial": {
        "advice": "ì¬íŒì¥ ì•ì—ì„œëŠ” ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ. ê¹Šì€ ëª…ìƒìœ¼ë¡œ ë§ˆìŒì„ ë¹„ìš°ì„¸ìš”.", 
        "video": "https://www.youtube.com/watch?v=inpok4MKVLM"  # Meditation music
    },
    "end": {
        "advice": "ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ë‹¬ë¹› ê°™ì€ ìŒì•…ì„ ë“¤ìœ¼ë©° íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.", 
        "video": "https://www.youtube.com/watch?v=CvFH_6DNRCY"  # Debussy Clair de Lune
    }
}

# -------------------------------------------------------------------------
# [2. ì§€ëŠ¥í˜• ë¡œì§ ë° í•µì‹¬ í•¨ìˆ˜]
# -------------------------------------------------------------------------
def get_available_models(api_key):
    if not api_key: return []
    try:
        genai.configure(api_key=api_key)
        return [m.name for m in genai.list_models() if 'generateContent' in m.supported_generation_methods]
    except: return []

def find_best_court(address, category):
    """
    ì£¼ì†Œì™€ ì‚¬ê±´ ì¢…ë¥˜(category)ë¥¼ ëª¨ë‘ ê³ ë ¤í•˜ì—¬ ìµœì ì˜ ë²•ì›ì„ ì°¾ìŠµë‹ˆë‹¤.
    ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬ + ì´í˜¼ì†Œì†¡ -> ì„œìš¸ê°€ì •ë²•ì› (ì¤‘ì•™ì§€ë²• X)
    """
    base_court = "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›"
    
    # 1. ì£¼ì†Œ ê¸°ë°˜ 1ì°¨ ë§¤í•‘
    if address:
        sorted_keys = sorted(JURISDICTION_MAP.keys(), key=len, reverse=True)
        for key in sorted_keys:
            if key in address:
                base_court = JURISDICTION_MAP[key]
                break
    
    # 2. ì‚¬ê±´ ì¢…ë¥˜ ê¸°ë°˜ íŠ¹ìˆ˜ ë²•ì› ë§¤í•‘ (ì„œìš¸/ìˆ˜ì›/ë¶€ì‚° ë“± ê°€ì •/íšŒìƒ ë²•ì› ì¡´ì¬ ì‹œ)
    special_logic = {
        "ê°€ì‚¬": {"ì„œìš¸": "ì„œìš¸ê°€ì •ë²•ì›", "ì¸ì²œ": "ì¸ì²œê°€ì •ë²•ì›", "ìˆ˜ì›": "ìˆ˜ì›ê°€ì •ë²•ì›", "ëŒ€ì „": "ëŒ€ì „ê°€ì •ë²•ì›", "ëŒ€êµ¬": "ëŒ€êµ¬ê°€ì •ë²•ì›", "ë¶€ì‚°": "ë¶€ì‚°ê°€ì •ë²•ì›", "ìš¸ì‚°": "ìš¸ì‚°ê°€ì •ë²•ì›", "ê´‘ì£¼": "ê´‘ì£¼ê°€ì •ë²•ì›"},
        "íšŒìƒ": {"ì„œìš¸": "ì„œìš¸íšŒìƒë²•ì›", "ìˆ˜ì›": "ìˆ˜ì›íšŒìƒë²•ì›", "ë¶€ì‚°": "ë¶€ì‚°íšŒìƒë²•ì›"},
        "íŒŒì‚°": {"ì„œìš¸": "ì„œìš¸íšŒìƒë²•ì›", "ìˆ˜ì›": "ìˆ˜ì›íšŒìƒë²•ì›", "ë¶€ì‚°": "ë¶€ì‚°íšŒìƒë²•ì›"},
        "í–‰ì •": {"ì„œìš¸": "ì„œìš¸í–‰ì •ë²•ì›"}
    }
    
    # ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ì¶”ì¶œ
    cat_key = ""
    if "ê°€ì‚¬" in category or "ì´í˜¼" in category or "ìƒì†" in category: cat_key = "ê°€ì‚¬"
    elif "íšŒìƒ" in category or "íŒŒì‚°" in category: cat_key = "íšŒìƒ"
    elif "í–‰ì •" in category: cat_key = "í–‰ì •"

    if cat_key:
        region_prefix = base_court[:2] # "ì„œìš¸", "ìˆ˜ì›" ë“± ì¶”ì¶œ
        if region_prefix in special_logic[cat_key]:
            return special_logic[cat_key][region_prefix]
            
    return base_court

def calculate_legal_costs(amount):
    try: amt = int(str(amount).replace(",", ""))
    except: amt = 0
    
    if amt <= 0: return 0, 0, 0 # ë¹„ì¬ì‚°ê¶Œ ì†Œì†¡ ë“±
    
    if amt <= 10000000: stamp = amt * 0.005
    elif amt <= 100000000: stamp = amt * 0.0045 + 5000
    else: stamp = amt * 0.004 + 55000
    stamp = max(1000, int(stamp // 100 * 100))
    svc = 5200 * (10 if amt <= 30000000 else 15)
    return amt, stamp, svc

def create_docx(title, content):
    doc = Document()
    doc.add_heading(title, 0).alignment = WD_ALIGN_PARAGRAPH.CENTER
    doc.add_paragraph(content)
    buf = BytesIO(); doc.save(buf); buf.seek(0)
    return buf

def get_gemini_response(api_key, model_name, prompt):
    try:
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel(model_name)
        return model.generate_content(prompt).text
    except Exception as e: return f"âŒ API í˜¸ì¶œ ì˜¤ë¥˜: {str(e)}"

# -------------------------------------------------------------------------
# [3. ë©”ì¸ UI ë° í†µí•© ì¹´í…Œê³ ë¦¬ ë¡œì§]
# -------------------------------------------------------------------------
with st.sidebar:
    st.title("âš–ï¸ AI ë²•ë¥  ë§ˆìŠ¤í„°")
    st.caption("v2.0 Pro Integrated")
    
    api_key = st.text_input("Google API Key", type="password")
    
    # ëª¨ë¸ ì„ íƒ
    available_models = get_available_models(api_key)
    default_models = ["models/gemini-2.0-flash-exp", "models/gemini-1.5-flash", "models/gemini-1.5-pro"]
    selected_model = st.selectbox("AI ëª¨ë¸ ì„ íƒ", available_models if available_models else default_models)
    
    st.divider()
    
    # [ì™„ì „í•œ 20ê°œ ì¹´í…Œê³ ë¦¬ ë©”ë‰´]
    menu_options = [
        "ë¬´ë£Œë²•ë¥ ìƒë‹´ (AI ì±—ë´‡)",
        "ì „ìì†Œì†¡ (ì§€ê¸‰ëª…ë ¹/ì±„ê¶Œì)",
        "ì „ìì†Œì†¡ (ì§€ê¸‰ëª…ë ¹/ì±„ë¬´ì)",
        "ë¯¼ì‚¬ì†Œì†¡ (ëŒ€ì—¬ê¸ˆ)",
        "ë¯¼ì‚¬ì†Œì†¡ (ì„ì°¨ë³´ì¦ê¸ˆ)",
        "ë¯¼ì‚¬ì†Œì†¡ (ì²­êµ¬ì´ì˜)",
        "ë¯¼ì‚¬ì†Œì†¡ (ì†í•´ë°°ìƒ)",
        "ë¯¼ì‚¬ì†Œì†¡ (êµ¬ìƒê¸ˆ)",
        "ë¯¼ì‚¬ì†Œì†¡ (íˆ¬ìê¸ˆ)",
        "ë¯¼ì‚¬ì†Œì†¡ (ì„ê¸ˆ,ë…¸ë¬´)",
        "ë¯¼ì‚¬ì†Œì†¡ (ê¸° íƒ€)",
        "ë¯¼ì‚¬ì§‘í–‰ (ë³´ì „ì²˜ë¶„)",
        "ì¬ì‚°ëª…ì‹œ/ì¬ì‚°ì¡°íšŒ",
        "ë¯¼ì‚¬ì§‘í–‰ (ì••ë¥˜/ê²½ë§¤)",
        "í˜•ì‚¬ì†Œì†¡",
        "í–‰ì •ì†Œì†¡",
        "í–‰ì •ì‹¬íŒ",
        "ê°€ì‚¬ì†Œì†¡ (ì´í˜¼,ìƒì†)",
        "ê°œì¸íŒŒì‚°/ê°œì¸íšŒìƒ"
    ]
    
    selected_menu = st.radio("ğŸ“‚ ë²•ë¥  ì„œë¹„ìŠ¤ ì„ íƒ", menu_options)
    
    st.divider()
    st.info(f"ëª¨ë“œ: **{selected_menu}**")
    
    # ê³µí†µ ë„êµ¬: ê´€í•  ì°¾ê¸° (ì—…ê·¸ë ˆì´ë“œ)
    st.subheader("ğŸ“ ê´€í•  ë²•ì› ìë™ ë§¤ì¹­")
    addr_input = st.text_input("ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: ì„œìš¸ ì„œì´ˆêµ¬, ëŒ€êµ¬ ë‹¬ì„œêµ¬)", placeholder="ì‹œ/êµ°/êµ¬ ì…ë ¥")
    if addr_input:
        st.session_state.rec_court = find_best_court(addr_input, selected_menu)
        st.success(f"ì¶”ì²œ ê´€í• : {st.session_state.rec_court}")

# --- ë©”ì¸ í™”ë©´ ë¡œì§ ë¶„ê¸° ---

st.header(f"{selected_menu} í†µí•© ì†”ë£¨ì…˜")

# [CASE 1: ë¬´ë£Œë²•ë¥ ìƒë‹´ (AI ì±—ë´‡)]
if "ë¬´ë£Œë²•ë¥ ìƒë‹´" in selected_menu:
    st.success("ğŸ’¬ AI ë³€í˜¸ì‚¬ê°€ 24ì‹œê°„ ëŒ€ê¸°ì¤‘ì…ë‹ˆë‹¤.")
    
    for chat in st.session_state.chat_history:
        with st.chat_message(chat["role"]):
            st.write(chat["content"])
            
    user_input = st.chat_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´í˜¼ ì†Œì†¡ ì‹œ ì¬ì‚°ë¶„í•  ë¹„ìœ¨ì€?)")
    
    if user_input:
        st.session_state.chat_history.append({"role": "user", "content": user_input})
        with st.chat_message("user"): st.write(user_input)
            
        with st.chat_message("assistant"):
            with st.spinner("ë²•ë¥  ë°ì´í„°ë² ì´ìŠ¤ ê²€ìƒ‰ ì¤‘..."):
                prompt = f"ë„ˆëŠ” í•œêµ­ ë²•ë¥  ì „ë¬¸ê°€ì•¼. ì§ˆë¬¸: {user_input}. íŒë¡€ì™€ ë²•ë ¹ì— ê·¼ê±°í•˜ì—¬ ìƒì„¸íˆ ë‹µë³€í•´."
                response = get_gemini_response(api_key, selected_model, prompt)
                st.write(response)
                st.session_state.chat_history.append({"role": "assistant", "content": response})

# [CASE 2: ë¬¸ì„œ ì‘ì„± ë° ë¶„ì„ (ë‚˜ë¨¸ì§€ ëª¨ë“  ì¹´í…Œê³ ë¦¬)]
else:
    tab1, tab2, tab3 = st.tabs(["ğŸ“ ì„œë¥˜ ì‘ì„±", "ğŸ” ì¦ê±°/ë¹„ìš©/ë§ˆì¸ë“œì¼€ì–´", "âš–ï¸ íŒë¡€ ê²€ìƒ‰"])
    
    # ì¹´í…Œê³ ë¦¬ë³„ ì„¤ì • (Role ì •ì˜)
    config = {
        "type": "ë²•ë¥  ì„œë©´", "role": "ì‹ ì²­ì¸", "opp": "í”¼ì‹ ì²­ì¸", 
        "desc": "ë²•ì›ì— ì œì¶œí•  ì„œë¥˜ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤."
    }
    
    # ë™ì  ì„¤ì • ë§¤í•‘
    if "ì§€ê¸‰ëª…ë ¹" in selected_menu: config = {"type": "ì§€ê¸‰ëª…ë ¹ì‹ ì²­ì„œ", "role": "ì±„ê¶Œì", "opp": "ì±„ë¬´ì", "desc": "ë…ì´‰ì ˆì°¨"}
    elif "ë¯¼ì‚¬ì†Œì†¡" in selected_menu: config = {"type": "ì†Œì¥", "role": "ì›ê³ ", "opp": "í”¼ê³ ", "desc": "ë¯¼ì‚¬ ë³¸ì•ˆ ì†Œì†¡"}
    elif "ì„ê¸ˆ" in selected_menu: config = {"type": "ì„ê¸ˆì²­êµ¬ì†Œì¥", "role": "ì›ê³ (ê·¼ë¡œì)", "opp": "í”¼ê³ (ì‚¬ì—…ì£¼)", "desc": "ì²´ë¶ˆì„ê¸ˆ"}
    elif "í˜•ì‚¬" in selected_menu: config = {"type": "ê³ ì†Œì¥", "role": "ê³ ì†Œì¸", "opp": "í”¼ê³ ì†Œì¸", "desc": "í˜•ì‚¬ ê³ ì†Œ"}
    elif "í–‰ì •" in selected_menu: config = {"type": "ì†Œì¥/ì‹¬íŒì²­êµ¬ì„œ", "role": "ì›ê³ (ì²­êµ¬ì¸)", "opp": "í”¼ê³ (ì²˜ë¶„ì²­)", "desc": "í–‰ì • ì²˜ë¶„ ë¶ˆë³µ"}
    elif "ê°€ì‚¬" in selected_menu: config = {"type": "ê°€ì‚¬ì†Œì¥", "role": "ì›ê³ ", "opp": "í”¼ê³ ", "desc": "ì´í˜¼/ìƒì†"}
    elif "íŒŒì‚°" in selected_menu or "íšŒìƒ" in selected_menu: config = {"type": "ê°œì‹œì‹ ì²­ì„œ", "role": "ì‹ ì²­ì¸", "opp": "ì±„ê¶Œìëª©ë¡", "desc": "ì±„ë¬´ ì¡°ì •"}

    # --- [TAB 1: ì„œë¥˜ ì‘ì„±] ---
    with tab1:
        st.subheader(f"ğŸ“„ {config['type']} ìë™ ì‘ì„±")
        
        c1, c2 = st.columns(2)
        with c1:
            party_a = st.text_input(f"{config['role']} ì´ë¦„", "í™ê¸¸ë™")
            party_b = st.text_input(f"{config['opp']} ì´ë¦„", "ê¹€ì² ìˆ˜")
        with c2:
            try: court_idx = COURT_LIST.index(st.session_state.rec_court)
            except: court_idx = 0
            target_court = st.selectbox("ì œì¶œ ë²•ì›", COURT_LIST, index=court_idx)

        # ê¸ˆì „ ì†Œì†¡ ì—¬ë¶€ í™•ì¸
        is_money = any(x in selected_menu for x in ["ë¯¼ì‚¬", "ì§€ê¸‰", "êµ¬ìƒ", "ì„ê¸ˆ", "ëŒ€ì—¬", "ì†í•´"])
        if is_money:
            st.session_state.amt_in = st.text_input("ì²­êµ¬ ê¸ˆì•¡ (ìˆ«ìë§Œ)", st.session_state.amt_in)
        
        facts = st.text_area("ì‹ ì²­ ì›ì¸ (êµ¬ì²´ì  ì‚¬ì‹¤ê´€ê³„)", height=150, placeholder="ëˆ„ê°€, ì–¸ì œ, ì–´ë””ì„œ, ë¬´ì—‡ì„, ì–´ë–»ê²Œ, ì™œ í–ˆëŠ”ì§€ ìœ¡í•˜ì›ì¹™ìœ¼ë¡œ ì‘ì„±")
        evidence = st.text_area("ì…ì¦ ë°©ë²• (ì¦ê±°)", "ì°¨ìš©ì¦, ì´ì²´ë‚´ì—­ì„œ, ë¬¸ì ìº¡ì²˜")
        
        if st.button("ğŸš€ AI ì„œë¥˜ ìƒì„±"):
            with st.spinner("AIê°€ ë²•ë¥  ë¬¸ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤..."):
                prompt_sys = f"ë‹¹ì‹ ì€ {selected_menu} ì „ë¬¸ ë³€í˜¸ì‚¬ì…ë‹ˆë‹¤. ëŒ€í•œë¯¼êµ­ì˜ ë²•ë¥  ì„œì‹ì— ë§ì¶° ì™„ë²½í•œ {config['type']}ì„ ì‘ì„±í•˜ì„¸ìš”."
                prompt_user = f"""
                ê´€í• : {target_court}
                {config['role']}: {party_a}
                {config['opp']}: {party_b}
                ê¸ˆì•¡: {st.session_state.amt_in if is_money else 'í•´ë‹¹ì—†ìŒ'}
                ë‚´ìš©: {facts}
                ì¦ê±°: {evidence}
                
                í˜•ì‹: ë²•ì› ì œì¶œìš© í‘œì¤€ ì–‘ì‹ (ì²­êµ¬ì·¨ì§€, ì²­êµ¬ì›ì¸ í•„ìˆ˜ í¬í•¨)
                """
                res = get_gemini_response(api_key, selected_model, prompt_sys + prompt_user)
                st.text_area("ìƒì„± ê²°ê³¼", res, height=500)
                st.download_button("ğŸ’¾ ë‹¤ìš´ë¡œë“œ (.docx)", create_docx(config['type'], res), f"{config['type']}.docx")

    # --- [TAB 2: ì¦ê±°/ë¹„ìš©/ë§ˆì¸ë“œì¼€ì–´ (ìŒì•… ê¸°ëŠ¥ ê°•í™”)] ---
    with tab2:
        st.subheader("ğŸ’° ë¹„ìš© ë° ì¼ì •")
        if is_money:
            a, s1, s2 = calculate_legal_costs(st.session_state.amt_in)
            cc1, cc2, cc3 = st.columns(3)
            cc1.metric("ì†Œê°€", f"{a:,}ì›")
            cc2.metric("ì¸ì§€ëŒ€", f"{s1:,}ì›")
            cc3.metric("ì†¡ë‹¬ë£Œ", f"{s2:,}ì›")
        
        st.divider()
        st.subheader("ğŸ§˜ ë§ˆì¸ë“œ ì¼€ì–´ (Mental Care & Timeline)")
        st.info("ê° ë‹¨ê³„ë³„ ì‹¬ë¦¬ ì•ˆì •ì„ ìœ„í•œ ìŒì•…ì´ ì œê³µë©ë‹ˆë‹¤. (ìœ íŠœë¸Œ ìë™ ì¬ìƒ)")
        
        # íƒ€ì„ë¼ì¸ ì •ì˜
        today = date.today()
        timeline_steps = [
            ("ì†Œì¥ ì ‘ìˆ˜", 0, "start"), ("ë¶€ë³¸ ì†¡ë‹¬", 4, "wait"), ("ë³€ë¡  ê¸°ì¼", 12, "fight"), 
            ("ì§‘ì¤‘ ì‹¬ë¦¬", 20, "trial"), ("íŒê²° ì„ ê³ ", 28, "end")
        ]
        
        for event, weeks, key in timeline_steps:
            d_str = (today + timedelta(weeks=weeks)).strftime("%Y.%m.%d")
            data = MIND_CARE_DB[key]
            
            with st.expander(f"ğŸ“Œ {d_str} ì˜ˆìƒ: {event}"):
                st.write(f"ğŸ’¬ **ì¡°ì–¸:** {data['advice']}")
                # [ê¸°ëŠ¥ ê°•í™”] ìœ íŠœë¸Œ ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ì‚½ì…
                st.video(data['video'])

    # --- [TAB 3: íŒë¡€ ê²€ìƒ‰] ---
    with tab3:
        st.subheader("âš–ï¸ ìœ ì‚¬ íŒë¡€ ì‹¬ì¸µ ë¶„ì„")
        q = st.text_input("ê²€ìƒ‰ í‚¤ì›Œë“œ", f"{selected_menu} íŒë¡€")
        if st.button("íŒë¡€ ë¶„ì„"):
            p = f"í‚¤ì›Œë“œ '{q}'ì™€ ê´€ë ¨ëœ ìµœì‹  ëŒ€ë²•ì› íŒë¡€ ê²½í–¥ì„ ë¶„ì„í•˜ê³ , í•´ë‹¹ ì‚¬ê±´ ìœ í˜•ì—ì„œ ìŠ¹ì†Œí•˜ê¸° ìœ„í•œ í•µì‹¬ ë²•ë¦¬ë¥¼ ìš”ì•½í•´ì¤˜."
            st.markdown(get_gemini_response(api_key, selected_model, p))